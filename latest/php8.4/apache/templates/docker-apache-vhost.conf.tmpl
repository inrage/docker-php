<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot {{ getenv "APACHE_VHOST_DIR" "/var/www/html" }}
    ServerName default

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <Directory "{{ getenv "APACHE_VHOST_DIR" "/var/www/html" }}">
        AllowOverride All

        Options -Indexes +FollowSymLinks
        Require all granted

        Options -MultiViews
    </Directory>

    <FilesMatch "^\.">
        Order allow,deny
        Deny from all
    </FilesMatch>

    <FilesMatch "\.(?:sh|sql|mysql|po|tpl|make|test)$">
        Order allow,deny
        Deny from all
    </FilesMatch>

    <FilesMatch "^Makefile">
        Order allow,deny
        Deny from all
    </FilesMatch>

    <DirectoryMatch "^\.|\/\.">
        Order allow,deny
        Deny from all
    </DirectoryMatch>

    RedirectMatch 404 ^/readme\.html$

    <Files "xmlrpc.php">
        Order allow,deny
        Deny from all
    </Files>

    <DirectoryMatch "^.*/\.git/">
        Order allow,deny
        Deny from all
    </DirectoryMatch>

    <LocationMatch "^/wp-content/uploads/woocommerce_uploads/">
        Order allow,deny
        Deny from all
    </LocationMatch>

    #################################################################
    # Cache HTTP
    #################################################################
    <IfModule mod_expires.c>
        ExpiresActive On

        ExpiresByType text/css              "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType application/x-javascript "access plus 1 year"
        ExpiresByType image/jpeg            "access plus 1 year"
        ExpiresByType image/png             "access plus 1 year"
        ExpiresByType image/gif             "access plus 1 year"
        ExpiresByType image/webp            "access plus 1 year"
        ExpiresByType image/svg+xml         "access plus 1 year"
        ExpiresByType font/woff             "access plus 1 year"
        ExpiresByType font/woff2            "access plus 1 year"
    </IfModule>

    <IfModule mod_headers.c>
        <LocationMatch "\.(?:css|js|jpe?g|png|gif|webp|svg|woff2?)$">
            Header set Cache-Control "public, max-age=31536000, immutable"
        </LocationMatch>

        <LocationMatch "\.(?:php|html?)$">
            Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        </LocationMatch>
    </IfModule>

    SetEnvIf Request_URI "^/wp-cron\.php$" dontlog
    SetEnvIf Request_URI "^/wp-admin/admin-ajax\.php$" dontlog
    CustomLog ${APACHE_LOG_DIR}/access.log combined env=!dontlog
</VirtualHost>

